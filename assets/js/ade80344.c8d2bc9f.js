"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3],{8570:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var a=n(79);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=d(n),k=r,c=m["".concat(s,".").concat(k)]||m[k]||u[k]||i;return n?a.createElement(c,l(l({ref:t},p),{},{components:n})):a.createElement(c,l({ref:t},p))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=k;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},2907:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(5675),r=n(79),i=n(3987);function l(e){const t=e.map((e=>({...e,parentIndex:-1,children:[]}))),n=Array(7).fill(-1);t.forEach(((e,t)=>{const a=n.slice(2,e.level);e.parentIndex=Math.max(...a),n[e.level]=t}));const a=[];return t.forEach((e=>{const{parentIndex:n,...r}=e;n>=0?t[n].children.push(r):a.push(r)})),a}function o(e){let{toc:t,minHeadingLevel:n,maxHeadingLevel:a}=e;return t.flatMap((e=>{const t=o({toc:e.children,minHeadingLevel:n,maxHeadingLevel:a});return function(e){return e.level>=n&&e.level<=a}(e)?[{...e,children:t}]:t}))}function s(e){const t=e.getBoundingClientRect();return t.top===t.bottom?s(e.parentNode):t}function d(e,t){let{anchorTopOffset:n}=t;const a=e.find((e=>s(e).top>=n));if(a){return function(e){return e.top>0&&e.bottom<window.innerHeight/2}(s(a))?a:e[e.indexOf(a)-1]??null}return e[e.length-1]??null}function p(){const e=(0,r.useRef)(0),{navbar:{hideOnScroll:t}}=(0,i.L)();return(0,r.useEffect)((()=>{e.current=t?0:document.querySelector(".navbar").clientHeight}),[t]),e}function m(e){const t=(0,r.useRef)(void 0),n=p();(0,r.useEffect)((()=>{if(!e)return()=>{};const{linkClassName:a,linkActiveClassName:r,minHeadingLevel:i,maxHeadingLevel:l}=e;function o(){const e=function(e){return Array.from(document.getElementsByClassName(e))}(a),o=function(e){let{minHeadingLevel:t,maxHeadingLevel:n}=e;const a=[];for(let r=t;r<=n;r+=1)a.push(`h${r}.anchor`);return Array.from(document.querySelectorAll(a.join()))}({minHeadingLevel:i,maxHeadingLevel:l}),s=d(o,{anchorTopOffset:n.current}),p=e.find((e=>s&&s.id===function(e){return decodeURIComponent(e.href.substring(e.href.indexOf("#")+1))}(e)));e.forEach((e=>{!function(e,n){n?(t.current&&t.current!==e&&t.current.classList.remove(r),e.classList.add(r),t.current=e):e.classList.remove(r)}(e,e===p)}))}return document.addEventListener("scroll",o),document.addEventListener("resize",o),o(),()=>{document.removeEventListener("scroll",o),document.removeEventListener("resize",o)}}),[e,n])}function u(e){let{toc:t,className:n,linkClassName:a,isChild:i}=e;return t.length?r.createElement("ul",{className:i?void 0:n},t.map((e=>r.createElement("li",{key:e.id},r.createElement("a",{href:`#${e.id}`,className:a??void 0,dangerouslySetInnerHTML:{__html:e.value}}),r.createElement(u,{isChild:!0,toc:e.children,className:n,linkClassName:a}))))):null}const k=r.memo(u);function c(e){let{toc:t,className:n="table-of-contents table-of-contents__left-border",linkClassName:s="table-of-contents__link",linkActiveClassName:d,minHeadingLevel:p,maxHeadingLevel:u,...c}=e;const g=(0,i.L)(),N=p??g.tableOfContents.minHeadingLevel,h=u??g.tableOfContents.maxHeadingLevel,b=function(e){let{toc:t,minHeadingLevel:n,maxHeadingLevel:a}=e;return(0,r.useMemo)((()=>o({toc:l(t),minHeadingLevel:n,maxHeadingLevel:a})),[t,n,a])}({toc:t,minHeadingLevel:N,maxHeadingLevel:h});return m((0,r.useMemo)((()=>{if(s&&d)return{linkClassName:s,linkActiveClassName:d,minHeadingLevel:N,maxHeadingLevel:h}}),[s,d,N,h])),r.createElement(k,(0,a.Z)({toc:b,className:n,linkClassName:s},c))}},7719:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>p,default:()=>N,frontMatter:()=>d,metadata:()=>m,toc:()=>k});var a=n(5675),r=n(79),i=n(8570),l=n(2907);const o={tableOfContentsInline:"tableOfContentsInline_iLkt"};function s(e){let{toc:t,minHeadingLevel:n,maxHeadingLevel:a}=e;return r.createElement("div",{className:o.tableOfContentsInline},r.createElement(l.Z,{toc:t,minHeadingLevel:n,maxHeadingLevel:a,className:"table-of-contents",linkClassName:null}))}const d={title:"Process Overview",sidebar_position:1},p=void 0,m={unversionedId:"api/bulk-submissions/process-overview",id:"api/bulk-submissions/process-overview",title:"Process Overview",description:"Typically, data is submitted to the Directory manually, by Organisation Administrators through forms in the web application.",source:"@site/docs/api/bulk-submissions/process-overview.mdx",sourceDirName:"api/bulk-submissions",slug:"/api/bulk-submissions/process-overview",permalink:"/api/bulk-submissions/process-overview",draft:!1,editUrl:"https://github.com/biobankinguk/biobankinguk/edit/main/docs/docs/api/bulk-submissions/process-overview.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Process Overview",sidebar_position:1},sidebar:"apiGuide",previous:{title:"Authentication",permalink:"/api/getting-started/authentication"},next:{title:"Examples",permalink:"/api/bulk-submissions/examples"}},u={},k=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"1. Submitting data",id:"1-submitting-data",level:2},{value:"Operations",id:"operations",level:3},{value:"Submit",id:"submit",level:4},{value:"Delete",id:"delete",level:4},{value:"Submission Record Types",id:"submission-record-types",level:3},{value:"Sample records",id:"sample-records",level:3},{value:"2. Checking Submission Status",id:"2-checking-submission-status",level:2},{value:"3. Completing Staged Submissions",id:"3-completing-staged-submissions",level:2},{value:"Commit staged data",id:"commit-staged-data",level:3},{value:"Update mode",id:"update-mode",level:4},{value:"Replace mode",id:"replace-mode",level:4},{value:"Reject staged data",id:"reject-staged-data",level:3}],c={toc:k},g="wrapper";function N(e){let{components:t,...n}=e;return(0,i.kt)(g,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Typically, data is submitted to the Directory manually, by Organisation Administrators through forms in the web application."),(0,i.kt)("p",null,"However for many Organisations, this is an unrealistic expectation,\ndue to the volume of data and the need to aggregate individual sample records into an anonymised, summarised ",(0,i.kt)("strong",{parentName:"p"},"Collection"),"."),(0,i.kt)("p",null,"The Directory API provides a set of HTTP endpoints and a process for submitting sample records in Bulk,\nand the Directory will take care of the aggregation and surfacing of data via Search."),(0,i.kt)(s,{toc:k,mdxType:"TOCInline"}),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"All Bulk Submission endpoints described here require ",(0,i.kt)("strong",{parentName:"p"},"Token Authentication"),"."),(0,i.kt)("p",null,"This process guide assumes you have a token and will use it to authenticate all requests."),(0,i.kt)("p",null,"Getting a token in turn requires ",(0,i.kt)("strong",{parentName:"p"},"Client Credentials")," for an ",(0,i.kt)("strong",{parentName:"p"},"Organisation"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Generating Client Credentials is covered in the ",(0,i.kt)("a",{parentName:"li",href:"directory/bulk-submissions/api-credentials"},"Directory Guide")),(0,i.kt)("li",{parentName:"ul"},"Authenticating with Basic Auth (for the ",(0,i.kt)("inlineCode",{parentName:"li"},"/token")," endpoint) is described in the ",(0,i.kt)("a",{parentName:"li",href:"../getting-started/authentication"},"Authentication")," documentation."),(0,i.kt)("li",{parentName:"ul"},"Authenticating with an access token is described in the ",(0,i.kt)("a",{parentName:"li",href:"../getting-started/authentication"},"Authentication")," documentation.")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Tokens have a short lifetime (e.g. 1 day), but last longer than a single\nrequest, so a client can cache and reuse a token until it expires, and only\nthen request a new one.")),(0,i.kt)("h2",{id:"1-submitting-data"},"1. Submitting data"),(0,i.kt)("p",null,"The first step of the Bulk Submissions process is to submit the data to a staging area."),(0,i.kt)("p",null,"Submissions are made at the ",(0,i.kt)("inlineCode",{parentName:"p"},"/submit")," endpoint, for a given Organisation Internal Identifier:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null}))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Method")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"POST"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"URL")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://<submissions-api>/submit/{id}"))))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"id")),(0,i.kt)("td",{parentName:"tr",align:null},"route"),(0,i.kt)("td",{parentName:"tr",align:null},"Organisation ID")))),(0,i.kt)("p",null,"The payload is detailed in the ",(0,i.kt)("a",{parentName:"p",href:"https://submissions.biobankinguk.org/"},"OpenAPI spec"),",\nbut some less obvious aspects are described here."),(0,i.kt)("p",null,"It is possible (and sometimes desirable) to make multiple submissions to staging before proceeding with committing the data."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"A single submission has a record limit of 10,000 operations.")),(0,i.kt)("h3",{id:"operations"},"Operations"),(0,i.kt)("p",null,"Submission payloads can contain multiple ",(0,i.kt)("strong",{parentName:"p"},"Operations"),":"),(0,i.kt)("h4",{id:"submit"},"Submit"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Submit")," will insert or update a record in the staging area."),(0,i.kt)("p",null,"When the staged data is committed, this record will be included in the live dataset"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Submit")," operations will have further requirements of mandatory properties.\nSome of these requirements are conditional on other property values.\nSee below for details depending on the submitted record type."),(0,i.kt)("h4",{id:"delete"},"Delete"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Delete")," will stage a deletion request for a record"),(0,i.kt)("p",null,"When the staged data is committed, this record will be deleted from the live dataset"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Delete")," operations only need to specify the identifying properties of the record.\nThese are properties marked as ",(0,i.kt)("strong",{parentName:"p"},"required")," in the OpenAPI model."),(0,i.kt)("h3",{id:"submission-record-types"},"Submission Record Types"),(0,i.kt)("p",null,"There are three record types that can be contained in a Submission:\n",(0,i.kt)("strong",{parentName:"p"},"Samples"),", ",(0,i.kt)("strong",{parentName:"p"},"Diagnoses")," and ",(0,i.kt)("strong",{parentName:"p"},"Treatments"),"."),(0,i.kt)("p",null,"While the API will accept and correctly store diagnoses and treatments,\nthey are of no use at this time as the Directory only deals with samples."),(0,i.kt)("h3",{id:"sample-records"},"Sample records"),(0,i.kt)("p",null,"Submitting Sample Records requires a number of additional mandatory properties,\nincluding some which are conditionally required based on other property values."),(0,i.kt)("admonition",{title:"Lookup valid values",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The valid values differ in different Directory instances, based on configuration,\nbut are accessible from public API endpoints on the Directory ",(0,i.kt)("strong",{parentName:"p"},"website")," app (",(0,i.kt)("strong",{parentName:"p"},"not")," the API app)."),(0,i.kt)("p",{parentName:"admonition"},"These endpoints are in the form"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre"},"https://<directory-website>/api/<propertyname>\n")),(0,i.kt)("p",{parentName:"admonition"},"(unless the notes below indicate a different data type than the matching property name.)"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"PreservationType Example"),(0,i.kt)("div",null,(0,i.kt)("p",{parentName:"admonition"},"You can see valid values for ",(0,i.kt)("inlineCode",{parentName:"p"},"PreservationType")," and which ",(0,i.kt)("inlineCode",{parentName:"p"},"StorageTemperature")," requires them\nby making the following request:"),(0,i.kt)("table",{parentName:"admonition"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null}))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Method")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"GET"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"URL")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://<directory-website>/api/PreservationType"))))),(0,i.kt)("p",{parentName:"admonition"},"and in the response payload, you can see that the ",(0,i.kt)("inlineCode",{parentName:"p"},"StorageTemperature")," ",(0,i.kt)("inlineCode",{parentName:"p"},"RT")," requires a valid ",(0,i.kt)("inlineCode",{parentName:"p"},"PreservationType"),"\nof either ",(0,i.kt)("inlineCode",{parentName:"p"},"Paraffin"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Resin (EM)")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"Resin (LM)"),"."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Sample Response payload"),(0,i.kt)("div",null,(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "Id": 4,\n    "Value": "N/A",\n    "SortOrder": 0,\n    "StorageTemperatureId": null,\n    "StorageTemperatureName": "",\n    "PreservationTypeCount": 0\n  },\n  {\n    "Id": 1,\n    "Value": "Paraffin",\n    "SortOrder": 1,\n    "StorageTemperatureId": 1,\n    "StorageTemperatureName": "RT",\n    "PreservationTypeCount": 0\n  },\n  {\n    "Id": 2,\n    "Value": "Resin (EM)",\n    "SortOrder": 2,\n    "StorageTemperatureId": 1,\n    "StorageTemperatureName": "RT",\n    "PreservationTypeCount": 0\n  },\n  {\n    "Id": 3,\n    "Value": "Resin (LM)",\n    "SortOrder": 3,\n    "StorageTemperatureId": 1,\n    "StorageTemperatureName": "RT",\n    "PreservationTypeCount": 0\n  }\n]\n'))))))),(0,i.kt)("p",null,"The Open API spec is poor at expressing these conditional relationships,\nso we cover that information here:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Mandatory status"),(0,i.kt)("th",{parentName:"tr",align:null},"Notes"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DateCreated")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2714 Yes"),(0,i.kt)("td",{parentName:"tr",align:null},"Must not be in the future compared to when the Submission payload was accepted.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"AgeAtDonation")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2754 If ",(0,i.kt)("inlineCode",{parentName:"td"},"YearOfBirth")," is empty"),(0,i.kt)("td",{parentName:"tr",align:null},"Preferred over ",(0,i.kt)("inlineCode",{parentName:"td"},"YearOfBirth"),". Must be a valid ",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/ISO_8601#Durations"},"ISO8601 Duration")," value; negatives (prefixed with ",(0,i.kt)("inlineCode",{parentName:"td"},"-"),") are accepted for pre-birth.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"YearOfBirth")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2754 If ",(0,i.kt)("inlineCode",{parentName:"td"},"AgeAtDonation")," is empty"),(0,i.kt)("td",{parentName:"tr",align:null},"If ",(0,i.kt)("inlineCode",{parentName:"td"},"AgeAtDonation")," is empty, this value will be used to calculate a best-guess age when compared with the Sample's ",(0,i.kt)("inlineCode",{parentName:"td"},"DateCreated"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Sex")),(0,i.kt)("td",{parentName:"tr",align:null},"\u274c No"),(0,i.kt)("td",{parentName:"tr",align:null},"Must be a valid value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"MaterialType")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2714 Yes"),(0,i.kt)("td",{parentName:"tr",align:null},"Must be a valid value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"StorageTemperature")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2714 Yes"),(0,i.kt)("td",{parentName:"tr",align:null},"Must be a valid value")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"PreservationType")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2754 If ",(0,i.kt)("inlineCode",{parentName:"td"},"StorageTemperature")," requires it"),(0,i.kt)("td",{parentName:"tr",align:null},"If provided, must be a valid value for the associated ",(0,i.kt)("inlineCode",{parentName:"td"},"StorageTemperature"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SampleContentMethod")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2754 If ",(0,i.kt)("inlineCode",{parentName:"td"},"MaterialType")," is not in the ",(0,i.kt)("inlineCode",{parentName:"td"},"Extracted Sample")," group"),(0,i.kt)("td",{parentName:"tr",align:null},"One of the following must be true: ",(0,i.kt)("ul",null,(0,i.kt)("li",null,"Both ",(0,i.kt)("inlineCode",{parentName:"td"},"SampleContentMethod")," and ",(0,i.kt)("inlineCode",{parentName:"td"},"SampleContent")," contain valid values"),(0,i.kt)("li",null,"Both ",(0,i.kt)("inlineCode",{parentName:"td"},"SampleContentMethod")," and ",(0,i.kt)("inlineCode",{parentName:"td"},"SampleContent")," are empty")))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SampleContent")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2754 If ",(0,i.kt)("inlineCode",{parentName:"td"},"SampleContentMethod")," is present"),(0,i.kt)("td",{parentName:"tr",align:null},"If provided, must be a valid SNOMED-CT Disease term from the Directory's ",(0,i.kt)("inlineCode",{parentName:"td"},"OntologyTerms")," list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ExtractionSite")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2754 If ",(0,i.kt)("inlineCode",{parentName:"td"},"MaterialType")," is in the ",(0,i.kt)("inlineCode",{parentName:"td"},"Tissue Sample")," group"),(0,i.kt)("td",{parentName:"tr",align:null},"If provided Must be a valid SNOMED-CT Body Organ term from the Directory's ",(0,i.kt)("inlineCode",{parentName:"td"},"OntologyTerms")," list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ExtractionProcedure")),(0,i.kt)("td",{parentName:"tr",align:null},"\u2754 If ",(0,i.kt)("inlineCode",{parentName:"td"},"MaterialType")," requires it"),(0,i.kt)("td",{parentName:"tr",align:null},"If provided, must be a valid SNOMED-CT Extraction Procedure term from the Directory's ",(0,i.kt)("inlineCode",{parentName:"td"},"OntologyTerms")," list, for the associated ",(0,i.kt)("inlineCode",{parentName:"td"},"MaterialType"),".")))),(0,i.kt)("h2",{id:"2-checking-submission-status"},"2. Checking Submission Status"),(0,i.kt)("p",null,"When a ",(0,i.kt)("inlineCode",{parentName:"p"},"POST")," request is made to the ",(0,i.kt)("inlineCode",{parentName:"p"},"/submit")," endpoint,\nif it passes the initial validation a ",(0,i.kt)("inlineCode",{parentName:"p"},"Submission ID")," will be returned."),(0,i.kt)("p",null,"This ID value can be used to query the status of the submission,\nanywhere ",(0,i.kt)("inlineCode",{parentName:"p"},"submissionId")," is required."),(0,i.kt)("p",null,"There are a number of ",(0,i.kt)("inlineCode",{parentName:"p"},"/status")," endpoints detailed in the ",(0,i.kt)("a",{parentName:"p",href:"https://submissions.biobankinguk.org/"},"OpenAPI spec")),(0,i.kt)("p",null,"The status endpoints are primarily provided for two reasons:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Determining errors with the submitted data"),(0,i.kt)("li",{parentName:"ul"},"Determining when the submissions has completed processing.")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Currently the ",(0,i.kt)("inlineCode",{parentName:"p"},"recordsProcessed")," field in the Status Summary does not function as expected."),(0,i.kt)("p",{parentName:"admonition"},"It is either ",(0,i.kt)("inlineCode",{parentName:"p"},"0")," (while processing is in progress), or equal to ",(0,i.kt)("inlineCode",{parentName:"p"},"totalRecords"),", once processing is complete.")),(0,i.kt)("p",null,"It is possible to have multiple submissions in progress at a time,\nbut in order to proceed with committing or rejecting the staged operations\nall submissions must have finished processing. The status endpoints allow visibility of this."),(0,i.kt)("p",null,"Often, the decision of whether to commit or reject is based on the errors identified during processing.\nAgain, this information is discoverable by the status endpoints to provide feedback and inform that decision."),(0,i.kt)("h2",{id:"3-completing-staged-submissions"},"3. Completing Staged Submissions"),(0,i.kt)("p",null,"Once all currently open Submissions have finished processing, there are several choices available:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Make more submissions, to stage more data"),(0,i.kt)("li",{parentName:"ol"},"Commit the currently staged data to the live dataset"),(0,i.kt)("li",{parentName:"ol"},"Reject the currently staged data")),(0,i.kt)("p",null,"Making more submissions is as simple as returning to Step 1 above."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Committing can only be proceed if there are no currently processing Submissions.")),(0,i.kt)("h3",{id:"commit-staged-data"},"Commit staged data"),(0,i.kt)("p",null,"If the results of the Submissions processing are acceptable,\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"/commit")," endpoint can be used to take ",(0,i.kt)("strong",{parentName:"p"},"all")," currently staged data\n(from all Submissions since the last commit or reject) and update the live system with it."),(0,i.kt)("p",null,"All staged operations (",(0,i.kt)("inlineCode",{parentName:"p"},"Submit")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Delete"),") will be applied\nto the current live dataset for the organisation in question."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If multiple operations (",(0,i.kt)("inlineCode",{parentName:"p"},"Submit")," and/or ",(0,i.kt)("inlineCode",{parentName:"p"},"Delete"),") have been submitted for the same record identifiers,\nthe most recent submission will take precedence")),(0,i.kt)("h4",{id:"update-mode"},"Update mode"),(0,i.kt)("p",null,"A ",(0,i.kt)("strong",{parentName:"p"},"Commit")," can be performed in ",(0,i.kt)("strong",{parentName:"p"},"Update")," mode, whereby records in the live dataset are left alone\nunless they are have a matching (by identifying fields) staged ",(0,i.kt)("strong",{parentName:"p"},"Operation"),"."),(0,i.kt)("p",null,"Essentially this mode ",(0,i.kt)("strong",{parentName:"p"},"updates")," the live dataset for the Organisation\nas per the changes described by the staged ",(0,i.kt)("strong",{parentName:"p"},"Operations"),"."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null}))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Method")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"POST"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"URL")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://<submissions-api>/{id}/commit?type=update"))))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"id")),(0,i.kt)("td",{parentName:"tr",align:null},"route"),(0,i.kt)("td",{parentName:"tr",align:null},"Organisation ID")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"type")),(0,i.kt)("td",{parentName:"tr",align:null},"query"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"replace")," or ",(0,i.kt)("inlineCode",{parentName:"td"},"update"))))),(0,i.kt)("p",null,"No request body is required; the request is a ",(0,i.kt)("inlineCode",{parentName:"p"},"POST")," because it has side effects."),(0,i.kt)("h4",{id:"replace-mode"},"Replace mode"),(0,i.kt)("p",null,"A ",(0,i.kt)("strong",{parentName:"p"},"Commit")," can be performed in ",(0,i.kt)("strong",{parentName:"p"},"Replace")," mode, whereby records in the live dataset are deleted\nunless they are have a matching (by identifying fields) staged ",(0,i.kt)("strong",{parentName:"p"},"Operation"),"."),(0,i.kt)("p",null,"Essentially this mode ",(0,i.kt)("strong",{parentName:"p"},"replaces")," the live dataset for the Organisation\nwith the dataset described by the staged ",(0,i.kt)("strong",{parentName:"p"},"Operations"),"."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null}))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Method")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"POST"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"URL")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://<submissions-api>/{id}/commit?type=replace"))))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"id")),(0,i.kt)("td",{parentName:"tr",align:null},"route"),(0,i.kt)("td",{parentName:"tr",align:null},"Organisation ID")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"type")),(0,i.kt)("td",{parentName:"tr",align:null},"query"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"replace")," or ",(0,i.kt)("inlineCode",{parentName:"td"},"update"))))),(0,i.kt)("p",null,"No request body is required; the request is a ",(0,i.kt)("inlineCode",{parentName:"p"},"POST")," because it has side effects."),(0,i.kt)("h3",{id:"reject-staged-data"},"Reject staged data"),(0,i.kt)("p",null,"If the results of the Submissions processing are ",(0,i.kt)("strong",{parentName:"p"},"not")," acceptable,\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"/reject")," endpoint can be used to delete ",(0,i.kt)("strong",{parentName:"p"},"all")," currently staged operations\n(from all Submissions since the last commit or reject) allowing for staging to start over."),(0,i.kt)("p",null,"All staged operations (",(0,i.kt)("inlineCode",{parentName:"p"},"Submit")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Delete"),") will be discarded."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null}),(0,i.kt)("th",{parentName:"tr",align:null}))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"Method")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"POST"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"URL")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://<submissions-api>/{id}/reject"))))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"id")),(0,i.kt)("td",{parentName:"tr",align:null},"route"),(0,i.kt)("td",{parentName:"tr",align:null},"Organisation ID")))),(0,i.kt)("p",null,"No request body is required; the request is a ",(0,i.kt)("inlineCode",{parentName:"p"},"POST")," because it has side effects."))}N.isMDXComponent=!0}}]);