# IdentityTool

This is a Command Line tool useful for managing some API Client access tasks at the moment.

It may be expanded upon later.

# Usage

It can be run from the source, or a build (distributed or built locally).

Running from source requires the .NET `5.0.x` SDK or newer.

### Base Command

Use the appropriate command from here and then add the command you want to run as documented below.

- `dotnet run -- ` to run from source
  - next to the `IdentityTool.csproj`
- `./IdentityTool.exe` for a native exe build
- `dotnet IdentityTool.dll -- ` for a .NET runtime build

Get help with the `--help` option.

## Configuration

It's a .NET Application, it supports the [usual Configuration Sources](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/) e.g.
- User Secrets
- `appsettings.json`
- Environment Variables

### Configuration Values:

| Key | Description | Example |
|-|-|-|
| `ConnectionStrings:Default` | The Database connection string for commands which need it. | `Server=(localdb)\mssqllocaldb;Database=Biobanks` |
| `Serilog` | Serilog configuration | [Serilog docs](https://github.com/serilog/serilog-settings-configuration) |

# Commands

## Add an ApiClient directly to a Biobank

This is the most common action, and essentially joins up most of the other tool and some manual steps into a single command.

It requires a Connection String for the central Directory Database you want to add the client record to.
This can be specified in Configuration, or on the command line.

### Command
- `api-clients add`
- use `--help` to see all the options and arguments

### Usage Scenarios

Typically, you probably just want to add a client for a given Biobank, have it auto generate the credentials and then tell you them so you can provide them to the person who needs them:
- `api-clients add --generate <biobankId>`

Or you might already have an ID and Secret, either generated by this tool or from elsewhere:
- `api-clients add --client-id <id> --client-secret <secret> <biobankId>`

Client Secrets should be at least 128 bit strong cryptographically random strings. We store them hashed in the database. (This tool does the hashing, so **you don't need to provide an already hashed secret**).

#### ℹ **Tips:**
- optionally add a client name `--client-name <name>`
- Specify a Connection String if not configured elsewhere: `--connection-string "<connection-string>"`
- `biobankId` is `OrganisationId` from the `Organisations` table.

## Generate a Secure Random Unique ID

This can be used to generate cryptographically strong 256bit Random Unique IDs. This tool uses it to create Client IDs and Secrets.

### Command
- `crypto generate-id`
- use `--help` to see all the options and arguments

### Usage Scenarios

Generate an ID for any purpose, including secure secrets.
- `crypto generate-id`

The generated ID (encoded as a Base64Url string) will be output.

#### ℹ **Tips:**
- Also output a SHA256 hash of the generated ID (encoded as a Base64Url string) by adding `--hash`

## Hash a string

This can be used to hash a string in the same consistent way that everything in the codebase that manually hashes does. It uses SHA256.

### Command
- `crypto hash`
- use `--help` to see all the options and arguments

### Usage Scenarios

Output the SHA256 hash of a string value, as well the original input value.
- `crypto hash <input string>`

The original input string and the generated hash (encoded as a Base64Url string) will be output.